# AI 隐患识别手机网站 - 技术路线方案

## 1. 项目概述
本项目旨在构建一个移动端友好的 Web 应用，利用国产 AI 视觉大模型识别图片中的安全隐患。系统分为“训练端”（专家/管理员用）和“用户端”（普通用户用）。

## 2. 技术栈选型

### 2.1 核心框架 (Frontend & Backend)
*   **框架**: **Next.js 14 (App Router)**
    *   *理由*: React 生态最成熟的框架，支持服务端渲染 (SSR) 和 API 路由，便于隐藏 API Key 并处理后端逻辑。同时也非常适合构建响应式移动端网页 (PWA)。
*   **语言**: **TypeScript**
    *   *理由*: 类型安全，符合用户对代码质量的高要求。

### 2.2 UI / UX (Mobile First)
*   **样式库**: **Tailwind CSS**
    *   *理由*: 原子化 CSS，开发速度快，易于适配移动端尺寸。
*   **组件库**: **Shadcn/ui** + **Lucide Icons**
    *   *理由*: 现代化、轻量级，易于定制，视觉效果好。

### 2.3 AI 引擎 (国产模型)
*   **首选模型**: **阿里云 - 通义千问 VL (Qwen-VL-Max)**
    *   *理由*: 国内视觉理解能力第一梯队 (SOTA)，支持图片上传与多轮对话，API 稳定 (DashScope)，符合“国内模型”要求。
*   **备选**: 智谱 AI (GLM-4V)。

### 2.4 数据存储 (Knowledge Base)
*   **数据库**: **SQLite** (搭配 Prisma ORM)
    *   *理由*: 轻量级，无需额外部署数据库服务器，文件型数据库适合 MVP 快速开发。后期可无缝迁移至 PostgreSQL/MySQL。
*   **存储内容**:
    *   `TrainingData`: 存储“训练”过的隐患案例（图片描述、隐患类型、专家修正后的建议）。
    *   `Logs`: 用户上传记录。

## 3. 核心功能实现逻辑

### 3.1 训练网页 (The "Training" Page)
此页面并非进行底层的模型微调 (Fine-tuning，成本高且慢)，而是构建**知识库 (Knowledge Base)** 和 **提示词优化 (Prompt Engineering)**。
1.  **上传**: 管理员上传典型隐患图片。
2.  **预分析**: 调用 Qwen-VL 进行初步分析。
3.  **专家修正**: 管理员修改 AI 的判断（例如：“AI 没识别出没戴安全帽” -> 管理员手动添加）。
4.  **保存**: 将图片特征和“正确答案”存入数据库。这构成了 AI 的“经验”。

### 3.2 用户网页 (The User Page)
1.  **拍照/上传**: 用户拍摄现场照片。
2.  **上下文构建 (RAG)**: 系统在后台检索数据库中相似的“训练案例”（可选，高级功能）或加载管理员设定的“重点关注隐患列表”。
3.  **AI 推理**: 将用户图片 + 系统提示词 (System Prompt) 发送给 Qwen-VL。
4.  **结果展示**: 界面高亮显示隐患区域（如模型支持坐标）或以列表形式列出隐患及整改建议。

## 4. 代码组织 (遵循用户规范)
*   **目录结构**:
    *   `/app`: Next.js 路由 (pages)。
    *   `/components`: UI 组件。
    *   `/lib/ai`: AI 服务封装 (QwenManager)。
    *   `/lib/db`: 数据库操作。
*   **命名规范**:
    *   变量: `imgSrc`, `hazards`, `isAnalyzing`
    *   方法: `analyzeImage()`, `saveRecord()`

## 6. 模型策略说明：RAG vs 微调 (Fine-tuning)

在阿里云百炼控制台中，你可能会看到“模型调优”和“模型部署”选项。针对本项目，我们采用的是 **RAG (检索增强生成)** 策略，而非传统的模型微调。

### 6.1 为什么不现在去阿里云“训练”？
*   **成本高**: 真正的模型微调（SFT）需要高性能 GPU 实例运行数小时，且需要准备数千张标注好的数据集。
*   **迭代慢**: 每次更新知识都需要重新训练和部署模型。
*   **当前模型已足够强**: `qwen-vl-max` 已经认识绝大多数通用物体（安全帽、梯子、火、水）。我们只需要告诉它“把这个场景按安全专家的标准分析”，它就能做得很好。

### 6.2 本项目的“训练”是什么？
我们应用中的“训练”实际上是**构建知识库**。
1.  专家上传图片并修正描述。
2.  这些数据存入数据库。
3.  用户拍照时，系统自动把类似的“专家经验”作为**提示词 (Prompt)** 发送给 AI。
*   **优势**: 实时生效，零训练成本，数据越积越聪明。

### 6.3 什么时候才需要去阿里云后台“训练”？
只有当 AI **完全不认识**你要检测的物体时。例如：你需要检测一种自家工厂特有的、市面上从未见过的“异形零件”。此时才需要收集几百张照片，在阿里云后台进行 SFT 微调。

